---
name: command-creator
description: コマンド定義を生成するエージェントスキル
allowed-tools: Read, Write, Edit, Grep, Glob
---
# Command Creator

## 1. 概要

ユーザーから提供された要件に基づき、コマンド定義を生成します。

## 2. 実施内容

### 2.1 テンプレートの読み込み

- [コマンドテンプレート](./templates/command-template.md) を読み込む

### 2.2 対話による要件収集

**初期ヒアリング:**

```markdown
【コマンド作成】
作成したいコマンドの目的や、実現したい処理について教えてください。

例:
- サブエージェントを作成するコマンド
- ドキュメントを生成して検証するコマンド
- コードをビルドしてデプロイするコマンド
```

- ユーザーの回答に基づき、以下の情報を分析:
  - コマンドの目的
  - 必要なサブエージェント
  - 必要なエージェントスキル
  - プロジェクト固有情報の有無

### 2.3 既存コマンドの確認

- 既存の類似コマンドが存在するか確認
- 類似コマンドがあれば、その内容を分析
- 重複を避けるためのにユーザーへ確認

ユーザーへの確認内容:

```markdown
既存の類似コマンドが存在します。

名称: [コマンド名]
説明:
[コマンド説明]

A. コマンドの新規作成
B. 既存コマンドの修正・拡張
C. キャンセル 
```

### 2.4 既存要素の確認

- 既存のサブエージェントを検索
- 既存のエージェントスキルを検索
- 利用可能な要素をリスト化
- 不足している要素があれば指摘

### 2.5 実装計画の作成

収集した情報を基に、以下の実装計画を作成：

#### 2.5.1 コマンド名の検討

- 命名規則: ケバブケースで実施内容を推察できる名前
- 推奨形式: `<動詞>-<対象>`（命令形）
- 複数案（目安：3案）を提示する
- 最適案が明確な場合は1案に集約することも可能

#### 2.5.2 実行対象の特定

- 使用するサブエージェントをリストアップ
- 使用するエージェントスキルをリストアップ
- 存在確認を実施

#### 2.5.3 入力情報の定義

- コマンド実行に必要なパラメータを定義
- プロジェクト固有情報（パス、URL等）を含める
- 各パラメータの説明を記述

#### 2.5.4 出力情報の定義

- コマンド実行結果として返される情報を定義
- 成果物のパスやステータス情報を含める

#### 2.5.5 実行フローの設計

- スキル実行の順序を定義
- 各ステップで以下を明示:
  - 実行するサブエージェントとスキル
  - 入力パラメータ
  - 出力結果
  - エラー時の動作
- 規約系スキルの参照タイミングを明記
- 条件分岐やループがあれば記述

#### 2.5.6 依存関係の明示

- 実行前に満たすべき条件を定義
- 必要なファイルやデータの存在確認

#### 2.5.7 エラーハンドリング方針の定義

- ロールバック対象と方法を定義
- リトライ戦略（対象、回数、間隔）を定義

#### 2.5.8 注意事項の策定

- 運用上の制約や重要事項を定義

## 3. 実装計画の提示と承認

- 作成した実装計画を要約して提示

対話フォーマット:

```markdown
【コマンド実装計画】

1. コマンド名
A: [候補1]
B: [候補2]
C: [候補3]
推奨: [候補1] - [簡潔な理由]

2. 実行対象
サブエージェント: [N]個
- [エージェント1]
- [エージェント2]

エージェントスキル: [M]個（規約系[X]個、作業系[Y]個）
- 規約系: [スキル1], [スキル2]
- 作業系: [スキル3], [スキル4]

3. 入力・出力
入力パラメータ: [N]個
- [パラメータ1]: [説明]
- [パラメータ2]: [説明]

出力情報: [M]個
- [出力1]: [説明]
- [出力2]: [説明]

4. 実行フロー
[N]ステップの処理フロー
1. [ステップ1の概要]
2. [ステップ2の概要]
...

5. エラーハンドリング
ロールバック対象: [N]個
リトライ戦略: 定義済み

6. 注意事項: [K]件
- [項目1]
- [項目2]

この内容で作成してよろしいですか？

A. 承認（作成を開始）
B. 修正（変更したい項目を指定）
```

対話フォーマットの例:

```markdown
【コマンド実装計画】

1. コマンド名
A: create-subagent
B: generate-subagent
C: new-subagent
推奨: create-subagent - 目的が明確で一般的

2. 実行対象
サブエージェント: 1個
- plugin-agent

エージェントスキル: 2個（規約系1個、作業系1個）
- 規約系: plugin-construction-guidelines
- 作業系: subagent-creator

3. 入力・出力
入力パラメータ: 2個
- agent_requirements: サブエージェントの要件
- output_path: 出力先パス（デフォルト: /mnt/user-data/outputs/）

出力情報: 3個
- subagent_definition_file: 生成されたサブエージェント定義ファイルのパス
- agent_name: 生成したエージェント名
- summary: 生成した定義の概要

4. 実行フロー
3ステップの処理フロー
1. plugin-agent が plugin-construction-guidelines を参照
2. plugin-agent が subagent-creator を実行（入力: agent_requirements, output_path）
3. 生成結果を報告

5. エラーハンドリング
ロールバック対象: 1個
- 生成途中のファイル

リトライ戦略: ユーザー入力エラーはリトライなし、ファイル書き込みエラーは最大3回

6. 注意事項: 2件
- 同名のサブエージェントが存在する場合は上書き確認を行う
- 生成されたファイルは必ず内容を確認してから使用する

この内容で作成してよろしいですか？

A. 承認（作成を開始）
B. 修正（変更したい項目を指定）
```

- Aの場合: そのまま作成に進む
- Bの場合: 修正したい項目を聞いて更新

## 4. 修正対応（必要な場合）

- ユーザーの修正指示に基づいて計画を更新
- 修正後の計画を再提示
- 承認されるまで繰り返し

## 5. テンプレートの適用

- 承認された実装計画をテンプレートに適用
- フロントマター（name, description, tools）を生成
- 各セクションを構造化して記述

## 6. 出力

- 生成されたコマンド定義

## 7. チェックリスト

- [ ] 参照するすべてのサブエージェントとスキルの存在を確認している
- [ ] プロジェクト固有情報（ファイルパス、URL等）を含めている
- [ ] 実行フローが具体的に記述されている（各ステップで入力・出力・エラー時の動作を明記）
- [ ] 規約系スキルの参照タイミングを明示している
- [ ] エラーハンドリング方針を定義している
- [ ] 依存関係が明確に記述されている
- [ ] コマンド名がケバブケースで実施内容を推察できる
